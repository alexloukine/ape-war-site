<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard | Ape War</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Variables */
        :root, [data-theme="dark"] {
            --primary: #ff6b35;
            --primary-dark: #e55a2b;
            --secondary: #00d4ff;
            --accent: #ffd700;
            --bg-body: #0a0a0f;
            --bg-darker: #050508;
            --bg-card: #12121a;
            --bg-card-hover: #1a1a25;
            --bg-navbar: rgba(10, 10, 15, 0.95);
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-muted: #666666;
            --border-light: rgba(255, 255, 255, 0.1);
            --border-primary: rgba(255, 107, 53, 0.3);
            --shadow-card: 0 10px 40px rgba(0, 0, 0, 0.5);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="light"] {
            --primary: #e55a2b;
            --bg-body: #f5f5f7;
            --bg-darker: #e8e8ed;
            --bg-card: #ffffff;
            --bg-card-hover: #f0f0f5;
            --bg-navbar: rgba(255, 255, 255, 0.95);
            --text-primary: #1a1a2e;
            --text-secondary: #555566;
            --text-muted: #888899;
            --border-light: rgba(0, 0, 0, 0.1);
            --shadow-card: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--bg-body);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Navbar */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 40px;
            background: var(--bg-navbar);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-light);
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--text-primary);
            text-decoration: none;
        }

        .logo-text .accent { color: var(--primary); }
        .logo-text .logo-io { color: var(--text-muted); font-weight: 400; }

        .nav-links {
            display: flex;
            gap: 30px;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            letter-spacing: 1px;
            transition: var(--transition);
        }

        .nav-links a:hover, .nav-links a.active {
            color: var(--primary);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-toggle {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 8px;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .theme-toggle:hover { color: var(--primary); }

        .theme-toggle svg {
            width: 20px;
            height: 20px;
        }

        [data-theme="dark"] .sun-icon { display: none; }
        [data-theme="light"] .moon-icon { display: none; }

        .nav-cta {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: #ffffff;
            padding: 10px 24px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 0.85rem;
            letter-spacing: 2px;
            text-decoration: none;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
        }

        .nav-cta:hover {
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
        }

        /* Main Content */
        main {
            flex: 1;
            padding: 120px 20px 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .page-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: 10px;
        }

        .page-title .accent { color: var(--primary); }

        .page-subtitle {
            color: var(--text-muted);
            font-size: 1.1rem;
            text-align: center;
            margin-bottom: 30px;
        }

        /* Reset Timer */
        .reset-timer {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 40px;
        }

        .timer-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            letter-spacing: 3px;
            margin-bottom: 8px;
        }

        .timer-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            animation: timer-pulse 2s ease-in-out infinite;
        }

        @keyframes timer-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Leaderboard */
        .leaderboard-container {
            width: 100%;
            max-width: 700px;
            background: var(--bg-card);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-light);
            overflow: hidden;
            box-shadow: var(--shadow-card);
        }

        .leaderboard-header {
            display: grid;
            grid-template-columns: 80px 1fr 100px;
            padding: 16px 24px;
            background: rgba(255, 107, 53, 0.1);
            border-bottom: 1px solid var(--border-primary);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--primary);
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .leaderboard-header .lb-col-kills {
            text-align: right;
        }

        .leaderboard-entries {
            max-height: 600px;
            overflow-y: auto;
        }

        .leaderboard-entries::-webkit-scrollbar { width: 6px; }
        .leaderboard-entries::-webkit-scrollbar-track { background: var(--bg-darker); }
        .leaderboard-entries::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }

        .leaderboard-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .leaderboard-entry {
            display: grid;
            grid-template-columns: 80px 1fr 100px;
            padding: 14px 24px;
            border-bottom: 1px solid var(--border-light);
            transition: var(--transition);
            align-items: center;
        }

        .leaderboard-entry:last-child { border-bottom: none; }
        .leaderboard-entry:hover { background: var(--bg-card-hover); }

        .lb-rank {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        .leaderboard-entry.rank-1 .lb-rank { color: #ffd700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
        .leaderboard-entry.rank-2 .lb-rank { color: #c0c0c0; text-shadow: 0 0 10px rgba(192, 192, 192, 0.5); }
        .leaderboard-entry.rank-3 .lb-rank { color: #cd7f32; text-shadow: 0 0 10px rgba(205, 127, 50, 0.5); }

        .lb-player {
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-primary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .lb-kills {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary);
            text-align: right;
        }

        .leaderboard-empty, .leaderboard-error {
            padding: 60px 20px;
            text-align: center;
            color: var(--text-muted);
        }

        .leaderboard-error { color: #ff6b6b; }

        .leaderboard-note {
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 20px;
        }

        /* CA Display */
        .ca-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-top: 30px;
            padding: 16px 24px;
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius);
            max-width: 700px;
            width: 100%;
        }

        .ca-label {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--primary);
            letter-spacing: 2px;
        }

        .ca-address {
            font-family: 'Rajdhani', monospace;
            font-size: 0.9rem;
            color: var(--text-secondary);
            word-break: break-all;
        }

        .ca-copy {
            background: transparent;
            border: 1px solid var(--border-light);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .ca-copy:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Social Links */
        .social-links {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .social-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .social-link:hover {
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-3px);
        }

        .social-link svg {
            width: 20px;
            height: 20px;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 30px;
            color: var(--text-muted);
            font-size: 0.9rem;
            border-top: 1px solid var(--border-light);
        }

        footer a {
            color: var(--primary);
            text-decoration: none;
        }

        /* Mobile */
        @media (max-width: 768px) {
            .navbar { padding: 12px 20px; }
            .nav-links { display: none; }
            .page-title { font-size: 1.8rem; }
            .timer-value { font-size: 2rem; }
            .leaderboard-header, .leaderboard-entry {
                grid-template-columns: 60px 1fr 80px;
                padding: 12px 16px;
            }
            .leaderboard-header { font-size: 0.65rem; }
            .lb-rank, .lb-player, .lb-kills { font-size: 0.9rem; }
            .ca-display {
                flex-direction: column;
                gap: 8px;
                text-align: center;
            }
            .ca-address { font-size: 0.75rem; }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-logo">
            <a href="/info/" class="logo-text">ape<span class="accent">war</span><span class="logo-io">.io</span></a>
        </div>
        <div class="nav-links">
            <a href="/info/">Home</a>
            <a href="/info/#features">Features</a>
            <a href="/leaderboard/" class="active">Leaderboard</a>
        </div>
        <div class="nav-right">
            <button class="theme-toggle" id="theme-toggle" title="Toggle theme">
                <svg class="moon-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
                <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"/>
                    <line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                </svg>
            </button>
            <a href="/" class="nav-cta">PLAY NOW</a>
        </div>
    </nav>

    <main>
        <h1 class="page-title">LIVE <span class="accent">LEADERBOARD</span></h1>
        <p class="page-subtitle">Top players reset every 3 hours. Compete for glory!</p>

        <div class="reset-timer">
            <span class="timer-label">RESETS IN</span>
            <span class="timer-value" id="reset-timer">--:--:--</span>
        </div>

        <div class="leaderboard-container">
            <div class="leaderboard-header">
                <span class="lb-col-rank">RANK</span>
                <span class="lb-col-player">PLAYER</span>
                <span class="lb-col-kills">KILLS</span>
            </div>
            <div class="leaderboard-entries" id="leaderboard-entries">
                <div class="leaderboard-loading" id="leaderboard-loading">
                    <div class="loading-spinner"></div>
                    <span>Loading leaderboard...</span>
                </div>
            </div>
        </div>

        <p class="leaderboard-note">Data refreshes automatically every 30 seconds</p>

        <div class="ca-display">
            <span class="ca-label">CA:</span>
            <span class="ca-address" id="ca-address">9fnZwY9i7Mi8UM4Yn9y7yHxb7eV5nd545PbDuo4apump</span>
            <button class="ca-copy" onclick="copyCA()">COPY</button>
        </div>
    </main>

    <footer>
        <div class="social-links">
            <a href="https://x.com/apewargame" target="_blank" class="social-link" title="X (Twitter)">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
            </a>
            <a href="https://pump.fun/coin/9fnZwY9i7Mi8UM4Yn9y7yHxb7eV5nd545PbDuo4apump" target="_blank" class="social-link" title="Pump.fun">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                </svg>
            </a>
        </div>
        <p>&copy; 2025 Ape War | <a href="/info/">Back to Home</a></p>
    </footer>

    <script>
        // Theme Toggle
        const themeToggle = document.getElementById('theme-toggle');
        const html = document.documentElement;
        const savedTheme = localStorage.getItem('theme') || 'dark';
        html.setAttribute('data-theme', savedTheme);

        themeToggle.addEventListener('click', () => {
            const newTheme = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });

        // LootLocker Leaderboard
        const LOOTLOCKER_GAME_KEY = 'dev_37197e1a9f474bca9bf8f6ad69eb65a7';
        const LEADERBOARD_KEY = 'global_kills_3h';
        const LEADERBOARD_COUNT = 20;
        let sessionToken = null;

        async function init() {
            updateResetTimer();
            setInterval(updateResetTimer, 1000);
            await refreshLeaderboard();
            setInterval(refreshLeaderboard, 30000);
        }

        async function createSession() {
            try {
                const res = await fetch('https://api.lootlocker.io/game/v2/session/guest', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ game_key: LOOTLOCKER_GAME_KEY, game_version: '1.0.0.0' })
                });
                const data = await res.json();
                return data.success ? data.session_token : null;
            } catch { return null; }
        }

        async function fetchLeaderboard(token) {
            try {
                const res = await fetch(
                    `https://api.lootlocker.io/game/leaderboards/${LEADERBOARD_KEY}/list?count=${LEADERBOARD_COUNT}`,
                    { headers: { 'x-session-token': token } }
                );
                return res.ok ? await res.json() : null;
            } catch { return null; }
        }

        async function refreshLeaderboard() {
            const container = document.getElementById('leaderboard-entries');
            if (!sessionToken) sessionToken = await createSession();
            if (!sessionToken) { renderError(container); return; }

            let data = await fetchLeaderboard(sessionToken);
            if (!data) {
                sessionToken = await createSession();
                if (sessionToken) data = await fetchLeaderboard(sessionToken);
            }

            if (!data) { renderError(container); return; }
            renderLeaderboard(container, data);
        }

        function renderLeaderboard(container, data) {
            if (!data.items || data.items.length === 0) {
                container.innerHTML = '<div class="leaderboard-empty"><p>No players yet. Be the first!</p></div>';
                return;
            }

            container.innerHTML = data.items.map(item => {
                const rank = item.rank;
                const name = item.player?.name || `Player_${item.member_id}`;
                const rankClass = rank <= 3 ? `rank-${rank}` : '';
                return `<div class="leaderboard-entry ${rankClass}">
                    <span class="lb-rank">#${rank}</span>
                    <span class="lb-player">${escapeHtml(name)}</span>
                    <span class="lb-kills">${item.score}</span>
                </div>`;
            }).join('');
        }

        function renderError(container) {
            container.innerHTML = '<div class="leaderboard-error"><p>Failed to load leaderboard</p><p style="margin-top:10px;font-size:0.85rem;color:var(--text-muted)">Will retry...</p></div>';
        }

        function updateResetTimer() {
            const el = document.getElementById('reset-timer');
            const now = new Date();
            const h = now.getUTCHours(), m = now.getUTCMinutes(), s = now.getUTCSeconds();
            let nextH = (Math.floor(h / 3) + 1) * 3;
            if (nextH >= 24) nextH = 0;
            let hLeft = nextH - h - 1, mLeft = 59 - m, sLeft = 59 - s;
            if (hLeft < 0) hLeft += 24;
            if (sLeft === 59 && s === 0) { sLeft = 0; mLeft++; }
            if (mLeft === 60) { mLeft = 0; hLeft++; }
            el.textContent = `${String(hLeft).padStart(2,'0')}:${String(mLeft).padStart(2,'0')}:${String(sLeft).padStart(2,'0')}`;
        }

        function escapeHtml(t) {
            const d = document.createElement('div');
            d.textContent = t;
            return d.innerHTML;
        }

        function copyCA() {
            const ca = document.getElementById('ca-address').textContent;
            navigator.clipboard.writeText(ca).then(() => {
                const btn = document.querySelector('.ca-copy');
                btn.textContent = 'COPIED!';
                setTimeout(() => btn.textContent = 'COPY', 2000);
            });
        }

        init();
    </script>
</body>
</html>
